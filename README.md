# üêÆ‚ÄØbulls_and_cows ‚Äî‚ÄØ–ø–æ–¥–±–æ—Ä –ø–∞—Ä ¬´–±—ã–∫‚ÄØ√ó‚ÄØ–∫–æ—Ä–æ–≤–∞¬ª

–†–µ—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∑–∞–¥–∞—á–∏ R&D‚Äë–∫–æ–º–∞–Ω–¥—ã:  
–º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è —Å–µ–ª–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å **EBV** –ø–æ—Ç–æ–º—Å—Ç–≤–∞ –ø—Ä–∏ —Å—Ç—Ä–æ–≥–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö:

1. –†–æ–¥—Å—Ç–≤–æ ¬´–±—ã–∫ ‚Äì –∫–æ—Ä–æ–≤–∞¬ª‚ÄØ‚â§‚ÄØ5‚ÄØ%  
2. –ù–∞‚ÄØ–∫–∞–∂–¥–æ–≥–æ –±—ã–∫–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è‚ÄØ‚â§‚ÄØ10‚ÄØ% –≤—Å–µ—Ö –∫–æ—Ä–æ–≤  
3. –ö–∞–∂–¥–∞—è –∫–æ—Ä–æ–≤–∞ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∞ —Ä–æ–≤–Ω–æ –∑–∞‚ÄØ–æ–¥–Ω–∏–º –±—ã–∫–æ–º

–î–≤–∞ —Ä–µ—à–∞—Ç–µ–ª—è:

| –†–µ–∂–∏–º   | –°–∫–æ—Ä–æ—Å—Ç—å | –¢–æ—á–Ω–æ—Å—Ç—å            | –í–Ω–µ—à–Ω–∏–π —Ä–µ—à–∞—Ç–µ–ª—å |
|---------|----------|---------------------|------------------|
| `greedy`| 10‚ÄØ‚Äì‚ÄØ15‚ÄØ—Å| ‚âà‚ÄØ‚Äë1‚ÄØ% –∫‚ÄØ–æ–ø—Ç–∏–º—É–º—É   | **–Ω–µ—Ç**          |
| `milp`  | 4‚ÄØ‚Äì‚ÄØ8‚ÄØ–º–∏–Ω| –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–ø—Ç–∏–º—É–º  | –Ω—É–∂–µ–Ω **CBC**    |

---

## 1‚ÄØ.‚ÄØ–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

| –®–∞–≥ | Linux‚ÄØ/‚ÄØmacOS¬†(bash/zsh) | Windows¬†PowerShell | Windows‚ÄØcmd |
|-----|--------------------------|--------------------|-------------|
| 1. –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å | `git clone https://github.com/DaniilMusin/bulls_and_cows.git`<br>`cd bulls_and_cows` | —Ç–æ¬†–∂–µ | —Ç–æ¬†–∂–µ |
| 2. –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ | `python -m venv .venv`<br>`source .venv/bin/activate` | `python -m venv .venv`<br>`.\.venv\Scripts\Activate.ps1` | `python -m venv .venv`<br>`.\.venv\Scripts\activate.bat` |
| 3. –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | `pip install -r requirements.txt`<br>*–ø–∞–∫–µ—Ç¬†`pulp[cbc]` –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–ª–µ—Å–æ —Å CBC* | —Ç–æ¬†–∂–µ | —Ç–æ¬†–∂–µ |
| 4. –¥–∞–Ω–Ω—ã–µ | –ø–æ–ª–æ–∂–∏—Ç–µ `bulls.csv`, `cows.csv`, `pedigree.csv` –≤ –∫–∞—Ç–∞–ª–æ–≥ **`data/`** | —Ç–æ¬†–∂–µ | —Ç–æ¬†–∂–µ |
| 5. –±—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á—ë—Ç | `python -m src.main --data_dir data --solver greedy` | —Ç–æ¬†–∂–µ | —Ç–æ¬†–∂–µ |
| 6. MILP‚Äë–æ–ø—Ç–∏–º—É–º | `python -m src.main --data_dir data --solver milp` | —Ç–æ¬†–∂–µ | —Ç–æ¬†–∂–µ |

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—è–≤–∏—Ç—Å—è **`cow_bull_assignments.csv`** (2¬†–∫–æ–ª–æ–Ω–∫–∏ `cow_id`,¬†`bull_id`).

> #### –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ pip –Ω–µ –Ω–∞—à—ë–ª CBC
> *Ubuntu/Debian*: `sudo apt-get install coinor-cbc`  
> *macOS (brew)*: `brew install cbc`  
> *Windows*: —Å–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ **cbc-win64-msvc17.zip** —Å¬†—Ä–µ–ª–∏–∑–æ–≤ COIN‚ÄëOR, —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å, –¥–æ–±–∞–≤–∏—Ç—å –ø—É—Ç—å –∫¬†`cbc.exe` –≤‚ÄØ`PATH`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `cbc --version`.

–ï—Å–ª–∏ CBC –ø–æ‚Äë–ø—Ä–µ–∂–Ω–µ–º—É –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º `--solver greedy`¬†‚Äî‚ÄØ–æ–Ω –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Ä–µ—à–∞—Ç–µ–ª–µ–π.

---

## 2‚ÄØ.‚ÄØ–¢–µ—Å—Ç—ã –∏ –ª–∏–Ω—Ç

```bash
# –≤–Ω—É—Ç—Ä–∏ .venv
pytest -q            # ..  (–∏–ª–∏ ... –µ—Å–ª–∏ CBC –Ω–∞–π–¥–µ–Ω –∏ MILP‚Äë—Ç–µ—Å—Ç –∞–∫—Ç–∏–≤–µ–Ω)
ruff src tests       # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è
```

---

## 3‚ÄØ.‚ÄØ–û–ø–∏—Å–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏¬†–º–µ—Ç—Ä–∏–∫

### 3.1¬†–°—Ç—Ä–∞—Ç–µ–≥–∏—è

1. **–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö** ‚Äì —Å—Ç—Ä–æ–∫–∏ —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏ `ebv` –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è.
2. **–†–∞—Å—á—ë—Ç —Ä–æ–¥—Å—Ç–≤–∞** ‚Äì –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç‚ÄØ`R` –ø–æ¬†Wright¬†(1922); –ø–∞—Ä—ã —Å¬†`R‚ÄØ>‚ÄØ0.05` –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è.
3. **–î–≤–∞ —Ä–µ—à–∞—Ç–µ–ª—è**

   * **greedy** ‚Äì –∫–æ—Ä–æ–≤—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ `EBV`‚ÄØ‚Üì, –≤—ã–±–∏—Ä–∞—é—Ç –ø–µ—Ä–≤–æ–≥–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –±—ã–∫–∞; –∫–≤–æ—Ç–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —Å—á—ë—Ç—á–∏–∫–æ–º.
   * **milp** ‚Äì 0‚Äë1‚ÄØMILP: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ¬†`x[cow,bull]`, —Ü–µ–ª—å `max¬†Œ£¬†ebv_child¬∑x`, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–º.‚ÄØ¬ß3.2; —Ä–µ—à–∞–µ—Ç—Å—è PuLP¬†+¬†CBC.
4. **–≠–∫—Å–ø–æ—Ä—Ç** ‚Äì –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ CSV.

### 3.2¬†–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| ‚Ññ | –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞                      | –ì–¥–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è                                 |
| - | --------------------------------- | -------------------------------------------------- |
| 1 | `R ‚â§ 0.05`                        | —Ñ–∏–ª—å—Ç—Ä –ø–µ—Ä–µ–¥ —Ä–µ—à–∞—Ç–µ–ª–µ–º                             |
| 2 | –∫–≤–æ—Ç–∞ –±—ã–∫–∞ `‚â§ 10‚ÄØ% –∫–æ—Ä–æ–≤`         | —Å—á—ë—Ç—á–∏–∫‚ÄØ/‚ÄØ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `Œ£_c x[c,b] ‚â§ quota`         |
| 3 | –∫–∞–∂–¥–∞—è –∫–æ—Ä–æ–≤–∞ —Ä–æ–≤–Ω–æ —É –æ–¥–Ω–æ–≥–æ –±—ã–∫–∞ | greedy: –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä; MILP: `Œ£_b x[c,b] = 1` |

### 3.3¬†–î–æ–ø—É—â–µ–Ω–∏—è / —É–ø—Ä–æ—â–µ–Ω–∏—è

* –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ–¥–æ–∫ ‚Üí –Ω–µ—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π.
* –ì–ª—É–±–∏–Ω–∞ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω–æ–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ 5¬†–ø–æ–∫–æ–ª–µ–Ω–∏—è–º–∏ (–≤–∫–ª–∞–¥ –¥–∞–ª—å–Ω–∏—Ö –ø—Ä–µ–¥–∫–æ–≤¬†<‚ÄØ0.02).
* –ü—Ä–æ–ø—É—Å–∫–∏ `ebv` ‚Üí –∂–∏–≤–æ—Ç–Ω–æ–µ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è.
* –î–∏—Å–ø–µ—Ä—Å–∏—è EBV –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ñ–ª–∞–≥–µ `--lambda_variance`; –ø–æ¬†—É–º–æ–ª—á–∞–Ω–∏—é ‚Äì —Ç–æ–ª—å–∫–æ mean.

### 3.4¬†–ú–µ—Ç—Ä–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–º–∏ –≤—ã–±–∏—Ä–∞–ª—Å—è –ª—É—á—à–∏–π –ø–æ–¥—Ö–æ–¥

| –ú–µ—Ç—Ä–∏–∫–∞                | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ             | –†–µ–∑—É–ª—å—Ç–∞—Ç                   |
| ---------------------- | ---------------------- | --------------------------- |
| Mean‚ÄØEBV\_child        | –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª–µ–≤–∞—è        | MILP¬†–≤—ã—à–µ –Ω–∞¬†‚âà‚ÄØ1‚ÄØ%          |
| Std‚ÄØEBV\_child         | —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø–æ—Ç–æ–º—Å—Ç–≤–∞ | —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º–æ                 |
| –ú–∞–∫—Å. –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±—ã–∫–∞ | —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å          | =‚ÄØ–∫–≤–æ—Ç–∞ (10‚ÄØ%)              |
| Runtime                | –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å           | Greedy‚ÄØ‚âà‚ÄØ15‚ÄØ—Å; MILP‚ÄØ‚âà‚ÄØ5‚ÄØ–º–∏–Ω |

**–í—ã–≤–æ–¥**: –∑–∞–∫–∞–∑—á–∏–∫—É –ø–µ—Ä–µ–¥–∞—ë–º `milp_solver_cow_bull_assignments.csv` (–≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–∞–∫—Å–∏–º—É–º), –∞ `greedy_solver_cow_bull_assignments.csv` ‚Äì –∫–∞–∫ –±—ã—Å—Ç—Ä—ã–π¬†fallback.

---

## 4‚ÄØ.‚ÄØFAQ

| –í–æ–ø—Ä–æ—Å                            | –û—Ç–≤–µ—Ç                                                                                          |
| --------------------------------- | ---------------------------------------------------------------------------------------------- |
| **–ü–æ—á–µ–º—É CBC?**                   | PuLP ‚Äî¬†—Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å; CBC¬†‚Äî¬†open‚Äësource MILP‚Äë–¥–≤–∏–∂–æ–∫, –∫–æ—Ç–æ—Ä—ã–π PuLP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.  |
| **–ú–æ–∂–Ω–æ –±–µ–∑ CBC?**                | –î–∞: `--solver greedy` (–ø—Ä–æ—Å–∞–¥–∫–∞ \~1‚ÄØ% –ø–æ mean¬†EBV).                                            |
| **pip –Ω–µ –Ω–∞—à—ë–ª CBC**              | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–∞–∫–µ—Ç (`apt`, `brew`) –∏–ª–∏ `cbc-win64`, –ª–∏–±–æ –æ—Å—Ç–∞–≤–∞–π—Ç–µ—Å—å –Ω–∞ greedy.        |
| **–ï—Å—Ç—å ‚Äúpip‚Äëonly‚Äù –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞?** | `pip install highspy` + –∑–∞–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤ –Ω–∞ `pulp.HIGHS_CMD` ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ exe –∏ —á–∞—Å—Ç–æ –±—ã—Å—Ç—Ä–µ–µ. |
| **–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∫–≤–æ—Ç—É 10‚ÄØ%?**      | `python -m src.main --bull_quota_frac 0.15 ‚Ä¶`                                                  |
| **–ö–∞–∫ —É—á–µ—Å—Ç—å –¥–∏—Å–ø–µ—Ä—Å–∏—é EBV?**     | —Ñ–ª–∞–≥ `--lambda_variance 0.01` (—Ç–æ–ª—å–∫–æ –¥–ª—è MILP).                                               |

---

## 5‚ÄØ.‚ÄØ–õ–æ–≥–∏–∫–∞ –º–æ–¥—É–ª–µ–π

* **`src/kinship.py`** ‚Äì LRU‚Äë–∫—ç—à + numba: –±—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á—ë—Ç `R`, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø–∞—Ä.
* **`src/model.py`** ‚Äì —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ greedy –∏ MILP; –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `--solver`.
* **`tests/`** ‚Äì —é–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏ `R`, e2e‚Äë—Ç–µ—Å—Ç (–∫–≤–æ—Ç–∞, –ø–æ–ª–Ω–æ—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π).
