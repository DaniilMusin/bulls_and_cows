# cow‑bull‑assignment

Полное решение задачи «Подбор пар для осеменения коров».

## Быстрый старт

```bash
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt

# bulls.csv, cows.csv, pedigree.csv → ./data
python -m src.main --data_dir data --solver greedy           # 10‑15 s
python -m src.main --data_dir data --solver milp             # 4‑8 мин

# с учётом разброса EBV (λ = 1e-3)
python -m src.main --data_dir data --solver milp --lambda_variance 0.001


Результат → `cow_bull_assignments.csv`.

## Логика

Программа работает с тремя исходными CSV‑файлами
`bulls.csv`, `cows.csv` и `pedigree.csv`. CLI‑обёртка находится в
`src/main.py`: после чтения данных строится аддитивная матрица родства,
которая ускоряет фильтрацию недопустимых пар бык‑корова. За построение
матрицы и подготовку допустимых комбинаций отвечает `kinship.py`
(функция `build_feasible_pairs`).

Решатели реализованы в `model.py`. На вход им передаются таблица пар и
квота на нагрузку одного быка. В режиме `greedy` коровы перебираются в
порядке убывания EBV и каждой назначается первый доступный бык. В режиме
`milp` формулируется 0‑1 MILP, максимизирующий средний EBV потомства. При задании параметра `--lambda_variance` в цель добавляется дополнительный
терм, увеличивающий разброс EBV.



Ограничения

1. R(bull,cow) ≤ 0.05
2. quota_bull = 10 % коров
3. каждая корова → ровно один бык

Цель – максимизировать средний EBV потомков и увеличить его разброс

Алгоритмы

- greedy – быстрая эвристика, погрешность ≈ 1 %
- milp – 0‑1 MILP (PuLP+CBC), решает двухкритериальную задачу:
  1. максимизирует средний ожидаемый EBV потомства;
  2. увеличивает разброс EBV, добавляя к цели сумму абсолютных отклонений
     от среднего с весом `lambda_variance`.

Валидация – `pytest`, метрики `mean/std EBV_child`, баланс нагрузки.


## Тесты

```bash
pytest -q         # все зелёные
```

## Future work

* параллельный расчёт R (multiprocessing/numba prange)
* сценарный анализ «исключить быка / изменить квоту»

